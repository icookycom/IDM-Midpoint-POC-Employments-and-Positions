<apti:object xmlns:apti="http://midpoint.evolveum.com/xml/ns/public/common/api-types-3" xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3" xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3" xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3" xmlns:org="http://midpoint.evolveum.com/xml/ns/public/common/org-3" xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3" xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3" xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" oid="00000000-0000-0000-0000-000000000702" version="220"  xsi:type="c:ArchetypeType">
        <_metadata id="3">
            <storage>
                <createTimestamp>2024-11-08T07:43:56.234Z</createTimestamp>
                <createChannel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#init</createChannel>
                <modifyTimestamp>2025-05-16T06:51:27.671Z</modifyTimestamp>
                <modifierRef>
                    <t:oid>00000000-0000-0000-0000-000000000002</t:oid>
                    <t:relation xmlns="http://prism.evolveum.com/xml/ns/public/types-3">org:default</t:relation>
                    <t:type xmlns="http://prism.evolveum.com/xml/ns/public/types-3">c:UserType</t:type>
                </modifierRef>
                <modifyChannel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</modifyChannel>
            </storage>
            <process>
                <requestTimestamp>2024-11-08T07:43:56.227Z</requestTimestamp>
            </process>
        </_metadata>
        <name>Person</name>
        <description>POCE modified Archetype for person users.</description>
        <operationExecution id="1793">
            <recordType>complex</recordType>
            <timestamp>2025-05-13T08:48:02.743Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="ea939731-75b9-4887-9069-59266fd2ec03" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1794">
            <recordType>complex</recordType>
            <timestamp>2025-05-13T08:52:36.794Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="5d387239-1e04-4f3b-8a08-0532c77f08fb" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000041">
            <recordType>simple</recordType>
            <timestamp>2025-05-16T06:46:44.950Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000026275</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000042">
            <recordType>simple</recordType>
            <timestamp>2025-05-16T06:48:26.025Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000028065</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000045">
            <recordType>simple</recordType>
            <timestamp>2025-05-16T06:49:06.425Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000029472</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000048">
            <recordType>simple</recordType>
            <timestamp>2025-05-16T06:50:05.696Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000030645</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000049">
            <recordType>simple</recordType>
            <timestamp>2025-05-16T06:51:27.698Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000032967</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000050">
            <recordType>complex</recordType>
            <timestamp>2025-05-22T15:28:55.569Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="b762dd06-578b-45a0-9f85-f4e624491d7b" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000051">
            <recordType>complex</recordType>
            <timestamp>2025-05-23T03:58:40.358Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="8f876e05-64ea-4cf6-aa97-376b6472f826" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1000000000052">
            <recordType>complex</recordType>
            <timestamp>2025-05-23T09:05:11.789Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="1333d492-e976-4f11-85c4-1dc17d598c08" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <assignment id="1">
            <_metadata id="4">
                <storage>
                    <createTimestamp>2024-11-08T07:43:56.234Z</createTimestamp>
                    <createChannel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#init</createChannel>
                </storage>
                <process>
                    <requestTimestamp>2024-11-08T07:43:56.227Z</requestTimestamp>
                </process>
                <provenance>
                    <acquisition id="5">
                        <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#init</channel>
                        <timestamp>2024-11-08T07:43:56.226Z</timestamp>
                    </acquisition>
                </provenance>
            </_metadata>
            <identifier>holderType</identifier>
            <activation>
                <effectiveStatus>enabled</effectiveStatus>
            </activation>
            <assignmentRelation id="2">
                <holderType>UserType</holderType>
            </assignmentRelation>
        </assignment>
        <iteration>0</iteration>
        <iterationToken/>
        <activation>
            <effectiveStatus>enabled</effectiveStatus>
            <enableTimestamp>2024-11-08T07:43:56.230Z</enableTimestamp>
        </activation>
        <inducement id="12">
            <policyRule>
                <name>Recompute Employment Roles on User data changes</name>
                <policyConstraints>
                    <or id="13">
                        <modification id="14">
                            <item>c:givenName</item>
                        </modification>
                        <modification id="15">
                            <item>c:familyName</item>
                        </modification>
                        <modification id="20">
                            <item>c:additionalName</item>
                        </modification>
                        <modification id="22">
                            <item>c:activation/c:administrativeStatus</item>
                        </modification>
                    </or>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="16">
                        <object>
                            <linkTarget id="17">
                                <linkType>User info to Employment Role</linkType>
                            </linkTarget>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:recompute/>
                        </executeScript>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <inducement id="121">
            <policyRule>
                <name>Recompute nickName Role on User data changes</name>
                <policyConstraints>
                    <or id="13">
                        <modification id="14">
                            <item>c:givenName</item>
                        </modification>
                        <modification id="15">
                            <item>c:familyName</item>
                        </modification>
                        <modification id="20">
                            <item>c:additionalName</item>
                        </modification>
                    </or>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="16">
                        <object>
                            <linkTarget id="17">
                                <linkType>User info to nickName Role</linkType>
                            </linkTarget>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:recompute/>
                        </executeScript>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <inducement id="176">
            <policyRule>
                <name>Recompute Role Employment on User Person membershipchange</name>
                <policyConstraints>
                    <alwaysTrue id="177"/>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="178">
                        <object>
                            <linkTarget id="179">
                                <changeSituation>changed</changeSituation>
                                <linkType>User info to Employment Role</linkType>
                            </linkTarget>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:recompute/>
                        </executeScript>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <inducement id="1777">
            <targetRef oid="8ae75673-e3b5-4905-8fe8-101eb1770e52" relation="org:default" type="c:RoleType"/>
        </inducement>
        <inducement id="999999999999">
            <policyRule>
                <name>TEST unassign project roles for project on unassign project role</name>
                <policyConstraints>
                    <modification id="1000000000022">
                        <name>ass</name>
                        <item>
                            <_value>c:assignment</_value>
                            <_metadata id="1000000000043">
                                <provenance>
                                    <acquisition id="1000000000044">
                                        <actorRef>
                                            <t:oid>00000000-0000-0000-0000-000000000002</t:oid>
                                            <t:relation xmlns="http://prism.evolveum.com/xml/ns/public/types-3">org:default</t:relation>
                                            <t:type xmlns="http://prism.evolveum.com/xml/ns/public/types-3">c:UserType</t:type>
                                        </actorRef>
                                        <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
                                        <timestamp>2025-05-16T06:49:06.362Z</timestamp>
                                    </acquisition>
                                </provenance>
                            </_metadata>
                        </item>
                    </modification>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="178">
                        <object>
                            <currentObject>
                                <type>c:RoleType</type>
                            </currentObject>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:pipeline list="true">
                                <s:action>
                                    <s:type>execute-script</s:type>
                                    <s:parameter>
                                        <s:name>script</s:name>
                                        <s:value>
                                            <code>
import com.evolveum.midpoint.xml.ns._public.common.common_3.*
import com.evolveum.midpoint.prism.delta.builder.*
import com.evolveum.midpoint.model.api.*


                               user_oid = focus.getOid()
                               role_oid = input.getOid()




log.info "UUUUUUUUU" + user_oid 
log.info "RRRRRRRRRR"  + role_oid




</code>
                                        </s:value>
                                    </s:parameter>
                                </s:action>
                            </s:pipeline>
                        </executeScript>
                        <privileges/>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <archetypePolicy>
            <display>
                <label>
                    <t:orig>Person</t:orig>
                    <t:norm>person</t:norm>
                    <t:translation>
                        <t:key>Person.label</t:key>
                    </t:translation>
                </label>
                <pluralLabel>
                    <t:orig>Persons</t:orig>
                    <t:norm>persons</t:norm>
                    <t:translation>
                        <t:key>Persons.pluralLabel</t:key>
                    </t:translation>
                </pluralLabel>
                <tooltip>Person</tooltip>
                <icon>
                    <cssClass>fa fa-user</cssClass>
                    <color>green</color>
                </icon>
            </display>
            <objectTemplateRef oid="00000000-0000-0000-0000-000000000380" relation="org:default" type="c:ObjectTemplateType"/>
            <adminGuiConfiguration>
                <objectDetails>
                    <summaryPanel>
                        <title1>
                            <expression>
                                <script>
                                    <code>import com.evolveum.midpoint.xml.ns._public.common.common_3.*
user_personalNumber = object.getPersonalNumber()
query_user = midpoint.queryFor(UserType.class, "personalNumber = $user_personalNumber and extension/person_employment_type = 'Основное' and archetypeRef matches (oid = '441f8e23-33cd-41f2-bbb6-beea20feeaee') and activation/effectiveStatus!='disabled'") 
result_user = midpoint.searchObjects(query_user)


if (basic.isEmpty(result_user))
{
return "Основного трудоустройства нет"
} else {
return ("Основное трудоустройство в " + basic.stringify(result_user.costCenter))
}</code>
                                </script>
                            </expression>
                        </title1>
                        <title2>
                            <expression>
                                <script>
                                    <code>import com.evolveum.midpoint.xml.ns._public.common.common_3.*
user_personalNumber = object.getPersonalNumber()
query_user = midpoint.queryFor(UserType.class, "personalNumber = $user_personalNumber and archetypeRef matches (oid = '441f8e23-33cd-41f2-bbb6-beea20feeaee') and activation/effectiveStatus!='disabled'") 
result_user = midpoint.searchObjects(query_user)

if (basic.isEmpty(result_user))
{
return ""
} else {
return ("Трудоустройства: " + result_user.name.join(", "))
}</code>
                                </script>
                            </expression>
                        </title2>
                        <title3>
                            <expression>
                                <script>
                                    <code>import com.evolveum.midpoint.xml.ns._public.common.common_3.*
user_personalNumber = object.getPersonalNumber()
query_user = midpoint.queryFor(UserType.class, "personalNumber = $user_personalNumber and archetypeRef matches (oid = '0d1b1269-0011-49e6-b9f1-e62e7827dfed') and activation/effectiveStatus!='disabled'") 
result_user = midpoint.searchObjects(query_user)

if (basic.isEmpty(result_user))
{
return ""
} else {
return ("Назначения: " + result_user.name.join(", "))
}</code>
                                </script>
                            </expression>
                        </title3>
                    </summaryPanel>
                </objectDetails>
            </adminGuiConfiguration>
            <links>
                <targetLink id="17">
                    <name>User info to Employment Role</name>
                    <selector>
                        <type>c:RoleType</type>
                        <archetypeRef oid="3e97bf04-93de-486b-a17b-ca686f9c6a68" relation="org:default" type="c:ArchetypeType"/>
                    </selector>
                </targetLink>
                <targetLink id="183">
                    <name>User info to nickName Role</name>
                    <selector>
                        <type>c:RoleType</type>
                        <archetypeRef oid="7f71dcf3-c89d-4e23-930b-215423af3849" relation="org:default" type="c:ArchetypeType"/>
                    </selector>
                </targetLink>
            </links>
        </archetypePolicy>
    </apti:object>
