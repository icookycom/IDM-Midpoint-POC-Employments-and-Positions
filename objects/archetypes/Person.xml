<apti:object xmlns:apti="http://midpoint.evolveum.com/xml/ns/public/common/api-types-3" xmlns="http://midpoint.evolveum.com/xml/ns/public/common/common-3" xmlns:c="http://midpoint.evolveum.com/xml/ns/public/common/common-3" xmlns:icfs="http://midpoint.evolveum.com/xml/ns/public/connector/icf-1/resource-schema-3" xmlns:org="http://midpoint.evolveum.com/xml/ns/public/common/org-3" xmlns:q="http://prism.evolveum.com/xml/ns/public/query-3" xmlns:ri="http://midpoint.evolveum.com/xml/ns/public/resource/instance-3" xmlns:t="http://prism.evolveum.com/xml/ns/public/types-3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" oid="00000000-0000-0000-0000-000000000702" version="146"  xsi:type="c:ArchetypeType">
        <_metadata id="3">
            <storage>
                <createTimestamp>2024-11-08T07:43:56.234Z</createTimestamp>
                <createChannel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#init</createChannel>
                <modifyTimestamp>2025-04-17T09:43:28.053Z</modifyTimestamp>
                <modifierRef>
                    <t:oid>00000000-0000-0000-0000-000000000002</t:oid>
                    <t:relation xmlns="http://prism.evolveum.com/xml/ns/public/types-3">org:default</t:relation>
                    <t:type xmlns="http://prism.evolveum.com/xml/ns/public/types-3">c:UserType</t:type>
                </modifierRef>
                <modifyChannel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</modifyChannel>
            </storage>
            <process>
                <requestTimestamp>2024-11-08T07:43:56.227Z</requestTimestamp>
            </process>
        </_metadata>
        <name>Person</name>
        <description>POCE modified Archetype for person users.</description>
        <operationExecution id="16">
            <recordType>complex</recordType>
            <timestamp>2025-03-07T07:36:42.171Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="b97d7896-f40d-4f70-b1d7-00f08b3b8019" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="180">
            <recordType>complex</recordType>
            <timestamp>2025-03-26T07:03:19.395Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="4a297939-0496-47e5-a5a3-cb40f81a7d6f" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1737">
            <recordType>complex</recordType>
            <timestamp>2025-04-02T06:17:04.616Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="d4bf6ef4-1268-4556-aeea-e9df67842985" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1742">
            <recordType>complex</recordType>
            <timestamp>2025-04-02T10:35:06.401Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="ed821526-c7c4-43eb-ab28-69f991a146cc" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1778">
            <recordType>simple</recordType>
            <timestamp>2025-04-15T07:47:11.782Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000182513</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1779">
            <recordType>simple</recordType>
            <timestamp>2025-04-16T09:48:45.048Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000093177</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1785">
            <recordType>simple</recordType>
            <timestamp>2025-04-16T09:49:15.271Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000093871</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1786">
            <recordType>simple</recordType>
            <timestamp>2025-04-16T09:51:36.935Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000095901</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1787">
            <recordType>complex</recordType>
            <timestamp>2025-04-16T12:17:54.322Z</timestamp>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <taskRef oid="17fbdfff-3d29-47a5-842d-9a3d28d52c4c" relation="org:default" type="c:TaskType"/>
            <activityPath/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <operationExecution id="1788">
            <recordType>simple</recordType>
            <timestamp>2025-04-17T09:43:28.074Z</timestamp>
            <operation>
                <objectDelta>
                    <t:changeType>modify</t:changeType>
                    <t:objectType>c:ArchetypeType</t:objectType>
                </objectDelta>
                <executionResult>
                    <operation>com.evolveum.midpoint.model.impl.lens.ChangeExecutor.executeDelta</operation>
                    <status>success</status>
                    <importance>normal</importance>
                    <token>1000000000000266196</token>
                </executionResult>
                <objectName>Person</objectName>
            </operation>
            <status>success</status>
            <initiatorRef oid="00000000-0000-0000-0000-000000000002" relation="org:default" type="c:UserType"/>
            <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#user</channel>
        </operationExecution>
        <assignment id="1">
            <_metadata id="4">
                <storage>
                    <createTimestamp>2024-11-08T07:43:56.234Z</createTimestamp>
                    <createChannel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#init</createChannel>
                </storage>
                <process>
                    <requestTimestamp>2024-11-08T07:43:56.227Z</requestTimestamp>
                </process>
                <provenance>
                    <acquisition id="5">
                        <channel>http://midpoint.evolveum.com/xml/ns/public/common/channels-3#init</channel>
                        <timestamp>2024-11-08T07:43:56.226Z</timestamp>
                    </acquisition>
                </provenance>
            </_metadata>
            <identifier>holderType</identifier>
            <activation>
                <effectiveStatus>enabled</effectiveStatus>
            </activation>
            <assignmentRelation id="2">
                <holderType>UserType</holderType>
            </assignmentRelation>
        </assignment>
        <iteration>0</iteration>
        <iterationToken/>
        <activation>
            <effectiveStatus>enabled</effectiveStatus>
            <enableTimestamp>2024-11-08T07:43:56.230Z</enableTimestamp>
        </activation>
        <inducement id="12">
            <policyRule>
                <name>Recompute Employment Roles on User data changes</name>
                <policyConstraints>
                    <or id="13">
                        <modification id="14">
                            <item>c:givenName</item>
                        </modification>
                        <modification id="15">
                            <item>c:familyName</item>
                        </modification>
                        <modification id="20">
                            <item>c:additionalName</item>
                        </modification>
                        <modification id="22">
                            <item>c:activation/c:administrativeStatus</item>
                        </modification>
                    </or>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="16">
                        <object>
                            <linkTarget id="17">
                                <linkType>User info to Employment Role</linkType>
                            </linkTarget>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:recompute/>
                        </executeScript>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <inducement id="121">
            <policyRule>
                <name>Recompute nickName Role on User data changes</name>
                <policyConstraints>
                    <or id="13">
                        <modification id="14">
                            <item>c:givenName</item>
                        </modification>
                        <modification id="15">
                            <item>c:familyName</item>
                        </modification>
                        <modification id="20">
                            <item>c:additionalName</item>
                        </modification>
                    </or>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="16">
                        <object>
                            <linkTarget id="17">
                                <linkType>User info to nickName Role</linkType>
                            </linkTarget>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:recompute/>
                        </executeScript>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <inducement id="176">
            <policyRule>
                <name>Recompute Role Employment on User Person membershipchange</name>
                <policyConstraints>
                    <alwaysTrue id="177"/>
                </policyConstraints>
                <policyActions>
                    <scriptExecution id="178">
                        <object>
                            <linkTarget id="179">
                                <changeSituation>changed</changeSituation>
                                <linkType>User info to Employment Role</linkType>
                            </linkTarget>
                        </object>
                        <executeScript xmlns:s="http://midpoint.evolveum.com/xml/ns/public/model/scripting-3">
                            <s:recompute/>
                        </executeScript>
                    </scriptExecution>
                </policyActions>
            </policyRule>
        </inducement>
        <inducement id="1777">
            <targetRef oid="8ae75673-e3b5-4905-8fe8-101eb1770e52" relation="org:default" type="c:RoleType"/>
        </inducement>
        <archetypePolicy>
            <display>
                <label>
                    <t:orig>Person</t:orig>
                    <t:norm>person</t:norm>
                    <t:translation>
                        <t:key>Person.label</t:key>
                    </t:translation>
                </label>
                <pluralLabel>
                    <t:orig>Persons</t:orig>
                    <t:norm>persons</t:norm>
                    <t:translation>
                        <t:key>Persons.pluralLabel</t:key>
                    </t:translation>
                </pluralLabel>
                <tooltip>Person</tooltip>
                <icon>
                    <cssClass>fa fa-user</cssClass>
                    <color>green</color>
                </icon>
            </display>
            <objectTemplateRef oid="00000000-0000-0000-0000-000000000380" relation="org:default" type="c:ObjectTemplateType"/>
            <adminGuiConfiguration>
                <objectDetails>
                    <summaryPanel>
                        <title1>
                            <expression>
                                <script>
                                    <code>import com.evolveum.midpoint.xml.ns._public.common.common_3.*
user_personalNumber = object.getPersonalNumber()
query_user = midpoint.queryFor(UserType.class, "personalNumber = $user_personalNumber and extension/person_employment_type = 'Основное' and archetypeRef matches (oid = '441f8e23-33cd-41f2-bbb6-beea20feeaee') and activation/effectiveStatus!='disabled'") 
result_user = midpoint.searchObjects(query_user)


if (basic.isEmpty(result_user))
{
return "Основного трудоустройства нет"
} else {
return ("Основное трудоустройство в " + basic.stringify(result_user.costCenter))
}</code>
                                </script>
                            </expression>
                        </title1>
                        <title2>
                            <expression>
                                <script>
                                    <code>import com.evolveum.midpoint.xml.ns._public.common.common_3.*
user_personalNumber = object.getPersonalNumber()
query_user = midpoint.queryFor(UserType.class, "personalNumber = $user_personalNumber and archetypeRef matches (oid = '441f8e23-33cd-41f2-bbb6-beea20feeaee') and activation/effectiveStatus!='disabled'") 
result_user = midpoint.searchObjects(query_user)

if (basic.isEmpty(result_user))
{
return ""
} else {
return ("Трудоустройства: " + result_user.name.join(", "))
}</code>
                                </script>
                            </expression>
                        </title2>
                        <title3>
                            <expression>
                                <script>
                                    <code>import com.evolveum.midpoint.xml.ns._public.common.common_3.*
user_personalNumber = object.getPersonalNumber()
query_user = midpoint.queryFor(UserType.class, "personalNumber = $user_personalNumber and archetypeRef matches (oid = '0d1b1269-0011-49e6-b9f1-e62e7827dfed') and activation/effectiveStatus!='disabled'") 
result_user = midpoint.searchObjects(query_user)

if (basic.isEmpty(result_user))
{
return ""
} else {
return ("Назначения: " + result_user.name.join(", "))
}</code>
                                </script>
                            </expression>
                        </title3>
                    </summaryPanel>
                </objectDetails>
            </adminGuiConfiguration>
            <links>
                <targetLink id="17">
                    <name>User info to Employment Role</name>
                    <selector>
                        <type>c:RoleType</type>
                        <archetypeRef oid="3e97bf04-93de-486b-a17b-ca686f9c6a68" relation="org:default" type="c:ArchetypeType"/>
                    </selector>
                </targetLink>
                <targetLink id="183">
                    <name>User info to nickName Role</name>
                    <selector>
                        <type>c:RoleType</type>
                        <archetypeRef oid="7f71dcf3-c89d-4e23-930b-215423af3849" relation="org:default" type="c:ArchetypeType"/>
                    </selector>
                </targetLink>
            </links>
        </archetypePolicy>
    </apti:object>
